<!-- start custom head snippets -->

<!-- Canonical URL redirect enforcement -->
<script>
  // Enforce canonical URL (www -> non-www or http -> https)
  if (window.location.host === 'www.leechanwoo-kor.github.io') {
    window.location.replace('https://leechanwoo-kor.github.io' + window.location.pathname + window.location.search + window.location.hash);
  }
</script>

<!-- DNS Prefetch for external resources -->
<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//pagead2.googlesyndication.com">
<link rel="dns-prefetch" href="//googletagmanager.com">
<link rel="dns-prefetch" href="//fundingchoicesmessages.google.com">
<link rel="dns-prefetch" href="//www.google-analytics.com">
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
<link rel="preconnect" href="https://www.google-analytics.com" crossorigin>

<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="180x180" href="{{site.baseurl}}/assets/logo.ico/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="{{site.baseurl}}/assets/logo.ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="{{site.baseurl}}/assets/logo.ico/favicon-16x16.png">
<link rel="manifest" href="{{site.baseurl}}/assets/logo.ico/site.webmanifest">
<link rel="mask-icon" href="{{site.baseurl}}/assets/logo.ico/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<!-- 소셜 미디어 메타 태그 강화 -->
<meta property="og:locale" content="ko_KR">
<meta property="og:type" content="{% if page.date %}article{% else %}website{% endif %}">
<meta property="og:site_name" content="{{ site.title }}">
{% if page.title %}
<meta property="og:title" content="{{ page.title }}">
<meta name="twitter:title" content="{{ page.title }}">
{% endif %}
{% if page.excerpt %}
<meta property="og:description" content="{{ page.excerpt | strip_html | truncate: 160 }}">
<meta name="twitter:description" content="{{ page.excerpt | strip_html | truncate: 160 }}">
{% endif %}
{% if page.header.image %}
<meta property="og:image" content="{{ site.url }}{{ page.header.image }}">
<meta name="twitter:image" content="{{ site.url }}{{ page.header.image }}">
{% elsif site.og_image %}
<meta property="og:image" content="{{ site.url }}{{ site.og_image }}">
<meta name="twitter:image" content="{{ site.url }}{{ site.og_image }}">
{% endif %}
<meta name="twitter:card" content="summary_large_image">
{% if site.twitter.username %}
<meta name="twitter:site" content="@{{ site.twitter.username }}">
{% endif %}

<!-- Custom CSS - preload for performance -->
<link rel="preload" href="{{site.baseurl}}/assets/css/custom/custom.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="{{site.baseurl}}/assets/css/custom/custom.css"></noscript>

<!-- Google Adsense - lazy load after page is interactive -->
<script>
  // Load AdSense only after page is fully interactive
  function loadAdsense() {
    if (window.adsbygoogleLoaded) return;
    window.adsbygoogleLoaded = true;
    var script = document.createElement('script');
    script.src = 'https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6158389106191012';
    script.crossOrigin = 'anonymous';
    script.async = true;
    document.body.appendChild(script);
  }
  // Use requestIdleCallback for non-critical ad loading
  if ('requestIdleCallback' in window) {
    requestIdleCallback(loadAdsense, { timeout: 3000 });
  } else {
    // Fallback: load after window load event
    window.addEventListener('load', function() {
      setTimeout(loadAdsense, 1000);
    });
  }
</script>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';

  mermaid.initialize({ 
    startOnLoad: false,
    theme: 'base', // 'dark' 대신 'base'를 써야 커스텀이 잘 먹힙니다.
    themeVariables: {
      darkMode: true,
      
      // 1. 기본 색상 (블로그 배경색과 조화롭게)
      background: '#252a34',      // 배경색 (Minimal Mistakes 다크 테마 기본색)
      primaryColor: '#3a414e',    // 노드(상자) 배경색
      primaryBorderColor: '#66fcf1', // 노드 테두리 색 (네온 민트색으로 강조)
      
      // 2. 글자 및 선 색상 (가시성 핵심)
      primaryTextColor: '#ffffff', // 노드 안 글자색 (흰색)
      textColor: '#ffffff',        // 일반 글자색 (흰색)
      lineColor: '#45a29e',        // 연결선 색상 (밝은 청록색)
      
      // 3. 기타 세부 설정
      mainBkg: '#252a34',          // 메인 배경
      noteBkg: '#fff5ad',          // 노트(Note) 배경 (밝은 노랑)
      noteTextColor: '#333'        // 노트 글자 (검정)
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    /* 기존 코드와 동일한 변환 로직 */
    const codeBlocks = document.querySelectorAll('pre code.language-mermaid, .language-mermaid pre code');
    codeBlocks.forEach((codeBlock) => {
      const preElement = codeBlock.closest('div.highlighter-rouge') || codeBlock.closest('pre');
      if (preElement) {
        const mermaidDiv = document.createElement('div');
        mermaidDiv.className = 'mermaid';
        mermaidDiv.textContent = codeBlock.textContent;
        preElement.parentNode.replaceChild(mermaidDiv, preElement);
      }
    });
    mermaid.run();
  });
</script>

<style>
  .mermaid svg { 
    max-width: 100%; 
    height: auto;
    background-color: transparent !important; /* 배경 투명 유지 */
  }
  /* 글자가 너무 작으면 키워줍니다 */
  .mermaid .nodeLabel, .mermaid .edgeLabel {
    font-size: 16px !important;
    font-weight: bold !important;
  }
</style>

<!-- end custom head snippets -->
