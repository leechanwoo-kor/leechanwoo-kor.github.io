{% if site.footer_scripts %}
  {% for script in site.footer_scripts %}
    <script src="{{ script | relative_url }}" defer></script>
  {% endfor %}
{% else %}
  <script src="{{ '/assets/js/main.min.js' | relative_url }}" defer></script>
{% endif %}

{% if page.layout == "search" %}
  {%- assign search_provider = site.search_provider | default: "lunr" -%}
  {%- case search_provider -%}
    {%- when "lunr" -%}
      {% include_cached search/lunr-search-scripts.html %}
    {%- when "google" -%}
      {% include_cached search/google-search-scripts.html %}
    {%- when "algolia" -%}
      {% include_cached search/algolia-search-scripts.html %}
  {%- endcase -%}
{% elsif site.search == true %}
  <!-- Lazy load search scripts only when search is triggered -->
  <script>
    (function() {
      var searchToggle = document.querySelector('.search__toggle');
      var searchLoaded = false;
      if (searchToggle) {
        searchToggle.addEventListener('click', function() {
          if (!searchLoaded) {
            searchLoaded = true;
            var scripts = [
              '{{ "/assets/js/lunr/lunr.min.js" | relative_url }}',
              '{{ "/assets/js/lunr/lunr-store.js" | relative_url }}',
              '{{ "/assets/js/lunr/lunr-en.js" | relative_url }}'
            ];
            scripts.forEach(function(src) {
              var script = document.createElement('script');
              script.src = src;
              script.defer = true;
              document.body.appendChild(script);
            });
          }
        }, { once: true });
      }
    })();
  </script>
{% endif %}

{% include analytics.html %}
{% include /comments-providers/scripts.html %}

{% if site.after_footer_scripts %}
  {% for script in site.after_footer_scripts %}
    <script src="{{ script | relative_url }}"></script>
  {% endfor %}
{% endif %}
