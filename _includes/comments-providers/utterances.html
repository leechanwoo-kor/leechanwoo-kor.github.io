<script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');
    if (!commentContainer) return;

    function loadUtterances() {
      if (commentContainer.dataset.loaded) return;
      commentContainer.dataset.loaded = 'true';

      var script = document.createElement('script');
      script.setAttribute('src', 'https://utteranc.es/client.js');
      script.setAttribute('repo', '{{ site.repository }}');
      script.setAttribute('issue-term', '{{ site.comments.utterances.issue_term | default: "pathname" }}');
      script.setAttribute('theme', '{{ site.comments.utterances.theme | default: "github-light" }}');
      script.setAttribute('crossorigin', 'anonymous');
      commentContainer.appendChild(script);
    }

    // Lazy load comments when visible using IntersectionObserver
    if ('IntersectionObserver' in window) {
      var observer = new IntersectionObserver(function(entries) {
        if (entries[0].isIntersecting) {
          loadUtterances();
          observer.disconnect();
        }
      }, { rootMargin: '200px' });
      observer.observe(commentContainer);
    } else {
      // Fallback for older browsers
      window.addEventListener('load', loadUtterances);
    }
  })();
</script>
